<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁñØÁãÇÁöÑÂç∑ÁéãÔºà‰ΩúËÄÖÔºöÂà´ÂÜçÊµÆÂ§∏‰∫ÜÁæ§Â∞èÁªÑÔºâ</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            background-color: #333;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background-color: #ddd;
            border-radius: 5px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #ddd;
        }
        .tab.active {
            background-color: #333;
            color: #fff;
        }
        .content {
            display: none;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .content.active {
            display: block;
        }
        .stat-box {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .stat-item {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
            text-align: center;
        }
        .btn {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .btn-danger {
            background-color: #f44336;
        }
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        .btn-warning {
            background-color: #ff9800;
        }
        .btn-warning:hover {
            background-color: #e65100;
        }
        .btn-primary {
            background-color: #2196F3;
        }
        .btn-primary:hover {
            background-color: #1976D2;
        }
        .btn-secondary {
            background-color: #9E9E9E;
        }
        .btn-secondary:hover {
            background-color: #757575;
        }
        .btn-success {
            background-color: #4CAF50;
        }
        .btn-success:hover {
            background-color: #388E3C;
        }
        .btn-info {
            background-color: #03A9F4;
        }
        .btn-info:hover {
            background-color: #0288D1;
        }
        .btn-dark {
            background-color: #333;
        }
        .btn-dark:hover {
            background-color: #111;
        }
        .btn-outline {
            background-color: transparent;
            border: 1px solid #333;
            color: black;
        }
        .btn-outline:hover {
            background-color: #333;
            color: white;
        }
        .quality {
            color: #fff;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            display: inline-block;
        }
        .quality-common {
            background-color: #fff;
            color: #000;
            border: 1px solid #ccc;
        }
        .quality-uncommon {
            background-color: #4CAF50;
        }
        .quality-rare {
            background-color: #2196F3;
        }
        .quality-epic {
            background-color: #9C27B0;
        }
        .quality-legendary {
            background-color: #FFC107;
        }
        .quality-mythic {
            background-color: #FF5722;
        }
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .equipment-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            position: relative;
        }
        .equipment-item.locked {
            background-color: #f5f5f5;
        }
        .equipment-item.locked::after {
            content: "üîí";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
        }
        .equipment-item.selected {
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }
        .equipment-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .equipment-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        .equipment-attrs {
            font-size: 12px;
            color: #666;
        }
        .equipment-attr {
            margin-bottom: 3px;
        }
        .equipment-slot {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .slot {
            border: 1px dashed #ccc;
            border-radius: 5px;
            padding: 10px;
            min-height: 100px;
            position: relative;
            cursor: pointer;
        }
        .slot-name {
            position: absolute;
            top: -10px;
            left: 10px;
            background-color: #333;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
        }
        .slot-empty {
            color: #999;
            text-align: center;
            /* line-height: 80px; */
        }
        .battle-log {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        .log-entry {
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        .map-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .map-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background-color: #f5f5f5;
        }
        .map-item.locked {
            background-color: #eee;
            color: #999;
        }
        .map-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .map-info {
            font-size: 12px;
            color: #666;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            max-width: 500px;
            width: 80%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }
        .modal-close {
            cursor: pointer;
            font-size: 20px;
        }
        .modal-body {
            margin-bottom: 20px;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .auto-sell-settings {
            margin-top: 15px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .auto-sell-settings h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .auto-sell-settings select, .auto-sell-settings input {
            margin-right: 10px;
            padding: 5px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }
        .auto-sell-settings button {
            margin-top: 10px;
        }
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .shop-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
        }
        .shop-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .shop-item-price {
            color: #ff9800;
            margin-bottom: 10px;
        }
        .progress-bar {
            height: 20px;
            background-color: #f5f5f5;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }
        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        .awakening-points {
            background-color: #ff9800;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 5px;
        }
        /* ËÉåÂåÖÁïåÈù¢ÊåâÈíÆÊ†∑Âºè */
        .btn-wear, .btn-lock, .btn-sell, .btn-unequip {
            color: black; /* ËÆæÁΩÆÂ≠ó‰ΩìÈ¢úËâ≤‰∏∫ÈªëËâ≤ */
        }
        /* Ë£ÖÂ§áÁïåÈù¢ËÑ±‰∏ãÊåâÈíÆÂ≠ó‰ΩìÈ¢úËâ≤ */
        .btn-remove-equipment {
            color: black; /* ËÆæÁΩÆÂ≠ó‰ΩìÈ¢úËâ≤‰∏∫ÈªëËâ≤ */
        }
        /* Ë£ÖÂ§áÈÄâÊã©ÂºπÁ™ó */
        .equipment-selection-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .equipment-selection-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            max-width: 600px; /* ËÆæÁΩÆÊúÄÂ§ßÂÆΩÂ∫¶ */
            width: 80%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            max-height: 80vh; /* ËÆæÁΩÆÊúÄÂ§ßÈ´òÂ∫¶‰∏∫ËßÜÂè£È´òÂ∫¶ÁöÑ80% */
            overflow-y: auto; /* ÂêØÁî®ÂûÇÁõ¥ÊªöÂä® */
        }
        .equipment-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .equipment-selection-title {
            font-size: 18px;
            font-weight: bold;
        }
        .equipment-selection-close {
            cursor: pointer;
            font-size: 20px;
        }
        .equipment-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .equipment-selection-footer {
            display: flex;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <script src="chs.js"></script>
    <script src="core.js"></script>
    <div class="container">
        <div class="header">
            <h1>ÁñØÁãÇÁöÑÂç∑ÁéãÔºà‰ΩúËÄÖÔºöÂà´ÂÜçÊµÆÂ§∏‰∫ÜÁæ§Â∞èÁªÑÔºâ</h1>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="character">ËßíËâ≤</div>
            <div class="tab" data-tab="equipment">Ë£ÖÂ§á</div>
            <div class="tab" data-tab="inventory">ËÉåÂåÖ</div>
            <div class="tab" data-tab="blacksmith">ÈìÅÂå†Èì∫</div>
            <div class="tab" data-tab="crystal-shop">Ê∞¥Êô∂ÂïÜÂ∫ó</div>
            <div class="tab" data-tab="maps">Âú∞Âõæ</div>
        </div>
        
        <div id="character" class="content active">
            <h2>ËßíËâ≤Â±ûÊÄß</h2>
            <div class="stat-box">
                <div class="stat-item">
                    <div>Á≠âÁ∫ß: <span id="character-level">1</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="exp-progress"></div>
                    </div>
                    <div class="progress-text">
                        <span id="current-exp">0</span>/<span id="required-exp">100</span>
                    </div>
                </div>
                <div class="stat-item">
                    <div>ÁîüÂëΩÂÄº: <span id="character-hp">30</span></div>
                    <div>È≠îÊ≥ïÂÄº: <span id="character-mp">30</span></div>
                    <div>ÊîªÂáªÂäõ: <span id="character-attack">5</span></div>
                    <div>Èò≤Âæ°Âäõ: <span id="character-defense">5</span></div>
                </div>
                <div class="stat-item">
                    <div>ÈáëÂ∏Å: <span id="character-gold">0</span></div>
                    <div>Ê∞¥Êô∂: <span id="character-crystal">0</span></div>
                </div>
                <div class="stat-item">
                    <div>Êö¥ÂáªÁéá: <span id="character-crit-rate">0%</span></div>
                    <div>Êö¥Âáª‰º§ÂÆ≥: <span id="character-crit-damage">0%</span></div>
                    <div>ÊîªÂáªÂäõÂä†Êàê: <span id="character-attack-bonus">0%</span></div>
                    <div>Èò≤Âæ°ÂäõÂä†Êàê: <span id="character-defense-bonus">0%</span></div>
                </div>
            </div>
            
            <div class="bonus-attributes">
                <h3>ÈôÑÂä†Â±ûÊÄß</h3>
                <div class="bonus-attribute">
                    <div>ÁªèÈ™åÊéâËêΩÂä†Êàê: <span id="exp-bonus">0%</span></div>
                </div>
                <div class="bonus-attribute">
                    <div>ÈáëÂ∏ÅÊéâËêΩÂä†Êàê: <span id="gold-bonus">0%</span></div>
                </div>
                <div class="bonus-attribute">
                    <div>Ê∞¥Êô∂ÊéâËêΩÂä†Êàê: <span id="crystal-bonus">0%</span></div>
                </div>
            </div>
            
            <h3>ÊàòÊñó‰ø°ÊÅØ</h3>
            <div class="battle-log" id="battle-log">
                <div class="log-entry">Ê¨¢ËøéÊù•Âà∞ÁñØÁãÇÁöÑÂç∑ÁéãÊ∏∏ÊàèÔºÅ</div>
                <div class="log-entry">ËØ∑ÈÄâÊã©Âú∞ÂõæÂºÄÂßãÂÜíÈô©ÔºÅ</div>
            </div>
            
            <!-- ÊöÇÂÅúÊàòÊñóÊåâÈíÆ -->
            <button class="btn btn-danger" id="pause-battle" style="margin-top: 10px;">ÊöÇÂÅúÊàòÊñó</button>
        </div>
        
        <div id="equipment" class="content">
            <h2>Ë£ÖÂ§áÁ≥ªÁªü</h2>
            <div class="equipment-slot">
                <div class="slot" data-slot="weapon-main">
                    <div class="slot-name">‰∏ªÊâãÊ≠¶Âô®</div>
                    <div class="slot-content" id="weapon-main-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="weapon-off">
                    <div class="slot-name">ÂâØÊâãÊ≠¶Âô®</div>
                    <div class="slot-content" id="weapon-off-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="helmet">
                    <div class="slot-name">Â§¥Áõî</div>
                    <div class="slot-content" id="helmet-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="armor">
                    <div class="slot-name">Êä§Áî≤</div>
                    <div class="slot-content" id="armor-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="gloves">
                    <div class="slot-name">ÊâãÂ•ó</div>
                    <div class="slot-content" id="gloves-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="boots">
                    <div class="slot-name">ÈûãÂ≠ê</div>
                    <div class="slot-content" id="boots-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="legs">
                    <div class="slot-name">Êä§ËÖø</div>
                    <div class="slot-content" id="legs-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="necklace">
                    <div class="slot-name">È°πÈìæ</div>
                    <div class="slot-content" id="necklace-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="ring-left">
                    <div class="slot-name">Â∑¶ÊàíÊåá</div>
                    <div class="slot-content" id="ring-left-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="ring-right">
                    <div class="slot-name">Âè≥ÊàíÊåá</div>
                    <div class="slot-content" id="ring-right-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="amulet">
                    <div class="slot-name">Êä§Á¨¶</div>
                    <div class="slot-content" id="amulet-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="badge">
                    <div class="slot-name">ÂæΩÁ´†</div>
                    <div class="slot-content" id="badge-content">Á©∫</div>
                </div>
                <div class="slot" data-slot="artefact">
                    <div class="slot-name">Ê≥ïÂô®</div>
                    <div class="slot-content" id="artefact-content">Á©∫</div>
                </div>
            </div>
        </div>
        
        <div id="inventory" class="content">
            <h2>ËÉåÂåÖÁ≥ªÁªü</h2>
            <div class="equipment-grid" id="inventory-grid">
                <!-- ËÉåÂåÖÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <div class="auto-sell-settings">
                <h3>Ëá™Âä®ÂîÆÂçñËÆæÁΩÆ</h3>
                <div>
                    <label>ÂìÅË¥®‰Ωé‰∫éÁ≠â‰∫é:</label>
                    <select id="auto-sell-quality">
                        <option value="common">ÊôÆÈÄö</option>
                        <option value="uncommon">Á≤æËâØ</option>
                        <option value="rare" selected>Á®ÄÊúâ</option>
                        <option value="epic">Âè≤ËØó</option>
                        <option value="legendary">‰º†ËØ¥</option>
                        <option value="mythic">Á•ûËØù</option>
                    </select>
                    <label>Á≠âÁ∫ß‰Ωé‰∫é:</label>
                    <input type="number" id="auto-sell-level" value="10" min="1">
                    <button class="btn btn-secondary" id="save-auto-sell-settings">‰øùÂ≠òËÆæÁΩÆ</button>
                </div>
            </div>
            
            <button class="btn btn-danger" id="sell-all-btn">‰∏ÄÈîÆÂîÆÂçñÊâÄÊúâË£ÖÂ§á</button>
        </div>
        
        <div id="blacksmith" class="content">
            <h2>ÈìÅÂå†Èì∫</h2>
            <div id="equipment-selection">
                <h3>ÈÄâÊã©Ë¶ÅÂº∫ÂåñÊàñËøõÂåñÁöÑË£ÖÂ§á</h3>
                <div id="worn-equipment-list">
                    <!-- Á©øÊà¥ÁöÑË£ÖÂ§áÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
            </div>
            
            <div id="reinforce-panel" style="display: none; margin-top: 20px;">
                <h3>Ë£ÖÂ§áÂº∫Âåñ</h3>
                <p>Ê∂àËÄóÈáëÂ∏ÅÂº∫ÂåñË£ÖÂ§áÔºåÊúÄÈ´òÂº∫Âåñ+200ÔºåÊØè+1Ë£ÖÂ§áÂ±ûÊÄßÊèêÈ´ò0.1%ÔºåÂº∫ÂåñÊàêÂäüÁéá‰∏∫10%</p>
                <div>
                    <label>ÂΩìÂâçÂº∫ÂåñÁ≠âÁ∫ß: <span id="current-reinforce">0</span></label>
                    <label>ÈúÄË¶ÅÈáëÂ∏Å: <span id="reinforce-cost">0</span></label>
                </div>
                <button class="btn btn-primary" id="do-reinforce">Âº∫Âåñ</button>
            </div>
            
            <div id="evolve-panel" style="display: none; margin-top: 20px;">
                <h3>Ë£ÖÂ§áËøõÂåñ</h3>
                <p>Ê∂àËÄóÊèêÂçáÂç∑ËΩ¥ÊèêÈ´òË£ÖÂ§áÂ±ûÊÄßÔºåÊØèÁ∫ßÊèêÈ´òË£ÖÂ§áÂêÑÈ°πÂ±ûÊÄß0.5%ÔºåÊàêÂäüÁéá‰∏∫10%ÔºåÊúÄÈ´òÊèêÂçáÁ≠âÁ∫ß‰∏∫+200</p>
                <div>
                    <label>ÂΩìÂâçËøõÂåñÁ≠âÁ∫ß: <span id="current-evolve">0</span></label>
                    <label>ÈúÄË¶ÅÂç∑ËΩ¥: <span id="evolve-cost">0</span></label>
                </div>
                <button class="btn btn-info" id="do-evolve">ËøõÂåñ</button>
            </div>
        </div>
        
        <div id="crystal-shop" class="content">
            <h2>Ê∞¥Êô∂ÂïÜÂ∫ó</h2>
            <div class="shop-items">
                <div class="shop-item">
                    <div class="shop-item-name">ÊèêÂçáÂç∑ËΩ¥</div>
                    <div class="shop-item-price">10Ê∞¥Êô∂</div>
                    <button class="btn" id="buy-evolve-scroll">Ë¥≠‰π∞</button>
                </div>
            </div>
        </div>
        
        <div id="maps" class="content">
            <h2>Âú∞ÂõæÈÄâÊã©</h2>
            <h3>ÊôÆÈÄöÂú∞Âõæ</h3>
            <div class="map-list" id="normal-maps">
                <!-- ÊôÆÈÄöÂú∞ÂõæÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <h3>ÁßòÂ¢ÉÂú∞Âõæ</h3>
            <div class="map-list" id="secret-maps">
                <!-- ÁßòÂ¢ÉÂú∞ÂõæÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
        
        <!-- Âº∫Âåñ/ËøõÂåñÁªìÊûúÂºπÁ™ó -->
        <div id="result-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="modal-title">Êìç‰ΩúÁªìÊûú</span>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- ÂºπÁ™óÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                </div>
                <div class="modal-footer">
                    <button class="btn" id="modal-close-btn">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
        
        <!-- ËßâÈÜíÂºπÁ™ó -->
        <div id="awakening-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="modal-title">ËßíËâ≤ËßâÈÜí</span>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <p>ÊÅ≠Âñú‰Ω†ËææÂà∞200Á∫ßÔºÅ‰Ω†ÁöÑËßíËâ≤Â∑≤ÁªèËßâÈÜíÔºÅ</p>
                    <p>Á≠âÁ∫ßÂ∑≤ÈáçÁΩÆ‰∏∫1ÔºåËé∑Âæó100ËßâÈÜíÁÇπ</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" id="awakening-confirm-btn">Á°ÆËÆ§</button>
                </div>
            </div>
        </div>
        
        <!-- ÊàòÊñó‰∏≠Êìç‰ΩúÊèêÁ§∫ÂºπÁ™ó -->
        <div id="battle-operation-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="modal-title">ÊèêÁ§∫</span>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <p>ËØ∑ÂÖàÊöÇÂÅúÊàòÊñóÂÜçËøõË°åÊ≠§Êìç‰Ωú„ÄÇ</p>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="battle-operation-close-btn">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
        
        <!-- Ë£ÖÂ§áÈÄâÊã©ÂºπÁ™ó -->
        <div id="equipment-selection-modal" class="equipment-selection-modal">
            <div class="equipment-selection-content">
                <div class="equipment-selection-header">
                    <span class="equipment-selection-title">ÈÄâÊã©Ë£ÖÂ§á</span>
                    <span class="equipment-selection-close" id="equipment-selection-close"></span>&times;</span>
                </div>
                <div class="equipment-selection-grid" id="equipment-selection-grid">
                    <!-- Ë£ÖÂ§áÈÄâÊã©ÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                </div>
                <div class="equipment-selection-footer">
                    <button class="btn btn-outline" id="equipment-selection-cancel">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ê∏∏ÊàèÊï∞ÊçÆÂ≠òÂÇ®
        const gameData = {
            character: {
                level: 1,
                exp: 0,
                maxExp: 100,
                awakeningPoints: 0,
                awakeningLevel: 0,
                derivedStats: {
                    attack: 5,
                    defense: 5,
                    hp: 30,
                    mp: 30,
                    expBonus: 0,
                    goldBonus: 0,
                    crystalBonus: 0,
                    critRate: 0,
                    critDamage: 0,
                    attackBonus: 0,
                    defenseBonus: 0
                },
                gold: 0,
                crystal: 0
            },
            equipment: {
                slots: {
                    'weapon-main': null,
                    'weapon-off': null,
                    'helmet': null,
                    'armor': null,
                    'gloves': null,
                    'boots': null,
                    'legs': null,
                    'necklace': null,
                    'ring-left': null,
                    'ring-right': null,
                    'amulet': null,
                    'badge': null,
                    'artefact': null
                },
                inventory: []
            },
            maps: {
                normal: [
                    { 
                        id: 0, 
                        name: "Â©¥ÂÑøÂç∑Áéã", 
                        minLevel: 1, 
                        maxLevel: 3, 
                        bossLevel: 3, 
                        minEquipLevel: 1, 
                        maxEquipLevel: 4, 
                        requiredPlayerLevel: 1 
                    },
                    { 
                        id: 1, 
                        name: "ÂπºÂÑøÂõ≠Âç∑Áéã", 
                        minLevel: 1, 
                        maxLevel: 10, 
                        bossLevel: 10, 
                        minEquipLevel: 1, 
                        maxEquipLevel: 10, 
                        requiredPlayerLevel: 1 
                    },
                    { 
                        id: 2, 
                        name: "Â∞èÂ≠¶Âç∑Áéã", 
                        minLevel: 11, 
                        maxLevel: 20, 
                        bossLevel: 20, 
                        minEquipLevel: 11, 
                        maxEquipLevel: 20, 
                        requiredPlayerLevel: 11 
                    },
                    { 
                        id: 3, 
                        name: "Âàù‰∏≠Âç∑Áéã", 
                        minLevel: 21, 
                        maxLevel: 30, 
                        bossLevel: 30, 
                        minEquipLevel: 21, 
                        maxEquipLevel: 30, 
                        requiredPlayerLevel: 21 
                    },
                    { 
                        id: 4, 
                        name: "È´ò‰∏≠Âç∑Áéã", 
                        minLevel: 31, 
                        maxLevel: 40, 
                        bossLevel: 40, 
                        minEquipLevel: 31, 
                        maxEquipLevel: 40, 
                        requiredPlayerLevel: 31 
                    },
                    { 
                        id: 5, 
                        name: "Â§ßÂ≠¶Âç∑Áéã", 
                        minLevel: 41, 
                        maxLevel: 50, 
                        bossLevel: 50, 
                        minEquipLevel: 41, 
                        maxEquipLevel: 50, 
                        requiredPlayerLevel: 41 
                    },
                    { 
                        id: 6, 
                        name: "Â∑•Á®ãÈÉ®Âç∑Áéã", 
                        minLevel: 51, 
                        maxLevel: 60, 
                        bossLevel: 60, 
                        minEquipLevel: 51, 
                        maxEquipLevel: 60, 
                        requiredPlayerLevel: 51 
                    }
                ],
                secret: [
                    { 
                        id: 7, 
                        name: "Âç∑Áéã1Á≤í‰ºüÂì•Â≠òÊîæÂ§Ñ", 
                        minLevel: 71, 
                        maxLevel: 90, 
                        bossLevel: 95, 
                        minEquipLevel: 71, 
                        maxEquipLevel: 95, 
                        requiredPlayerLevel: 71 
                    },
                    { 
                        id: 8, 
                        name: "Âç∑Áéã9Á≤í‰ºüÂì•Â≠òÊîæÂ§Ñ", 
                        minLevel: 91, 
                        maxLevel: 110, 
                        bossLevel: 115, 
                        minEquipLevel: 96, 
                        maxEquipLevel: 115, 
                        requiredPlayerLevel: 91 
                    },
                    { 
                        id: 9, 
                        name: "Âç∑Áéã99Á≤í‰ºüÂì•Â≠òÊîæÂ§Ñ", 
                        minLevel: 116, 
                        maxLevel: 140, 
                        bossLevel: 145, 
                        minEquipLevel: 116, 
                        maxEquipLevel: 150, 
                        requiredPlayerLevel: 116 
                    },
                    { 
                        id: 10, 
                        name: "Âç∑Áéã999Á≤í‰ºüÂì•Â≠òÊîæÂ§Ñ", 
                        minLevel: 141, 
                        maxLevel: 165, 
                        bossLevel: 170, 
                        minEquipLevel: 141, 
                        maxEquipLevel: 170, 
                        requiredPlayerLevel: 141 
                    },
                    { 
                        id: 11, 
                        name: "Âç∑Áéã9999Á≤í‰ºüÂì•Â≠òÊîæÂ§Ñ", 
                        minLevel: 170, 
                        maxLevel: 200, 
                        bossLevel: 200, 
                        minEquipLevel: 170, 
                        maxEquipLevel: 200, 
                        requiredPlayerLevel: 170 
                    }
                ]
            },
            currentMap: null,
            battleLog: [],
            battleInterval: null,
            battleSpeed: 1000, // ÈªòËÆ§1Áßí‰∏ÄÊ¨°ÊàòÊñó
            autoSellSettings: {
                quality: "rare",
                level: 10
            },
            lastActivityTime: Date.now(),
            offlineExp: 0,
            offlineGold: 0,
            offlineEquipment: []
        };

        // Ë£ÖÂ§áÂìÅË¥®ÂÆö‰πâ
        const equipmentQuality = {
            common: { name: "ÊôÆÈÄö", color: "#ffffff", dropRate: 0.05, baseMultiplier: 1, additionalCount: 1 },
            uncommon: { name: "Á≤æËâØ", color: "#4CAF50", dropRate: 0.05, baseMultiplier: 1.2, additionalCount: 2 },
            rare: { name: "Á®ÄÊúâ", color: "#2196F3", dropRate: 0.04, baseMultiplier: 1.5, additionalCount: 3 },
            epic: { name: "Âè≤ËØó", color: "#9C27B0", dropRate: 0.03, baseMultiplier: 2, additionalCount: 4 },
            legendary: { name: "‰º†ËØ¥", color: "#FFC107", dropRate: 0.02, baseMultiplier: 3, additionalCount: 5 },
            mythic: { name: "Á•ûËØù", color: "#FF5722", dropRate: 0.01, baseMultiplier: 4, additionalCount: 6 }
        };

        // Ë£ÖÂ§áÈÉ®‰ΩçÂÆö‰πâ
        const equipmentSlots = {
            'weapon-main': "‰∏ªÊâãÊ≠¶Âô®",
            'weapon-off': "ÂâØÊâãÊ≠¶Âô®",
            'helmet': "Â§¥Áõî",
            'armor': "Êä§Áî≤",
            'gloves': "ÊâãÂ•ó",
            'boots': "ÈûãÂ≠ê",
            'legs': "Êä§ËÖø",
            'necklace': "È°πÈìæ",
            'ring-left': "Â∑¶ÊàíÊåá",
            'ring-right': "Âè≥ÊàíÊåá",
            'amulet': "Êä§Á¨¶",
            'badge': "ÂæΩÁ´†",
            'artefact': "Ê≥ïÂô®"
        };

        // Ë£ÖÂ§áÂü∫Á°ÄÂ±ûÊÄß
        const equipmentBaseAttributes = {
            'weapon-main': ["ÊîªÂáªÂäõ"],
            'weapon-off': ["ÊîªÂáªÂäõ"],
            'helmet': ["ÁîüÂëΩÂÄº", "È≠îÊ≥ïÂÄº"],
            'armor': ["ÁîüÂëΩÂÄº", "Èò≤Âæ°Âäõ"],
            'gloves': ["ÊîªÂáªÂäõ", "Èò≤Âæ°Âäõ"],
            'boots': ["ÁîüÂëΩÂÄº", "È≠îÊ≥ïÂÄº"],
            'legs': ["ÁîüÂëΩÂÄº", "Èò≤Âæ°Âäõ"],
            'necklace': ["È≠îÊ≥ïÂÄº", "ÊîªÂáªÂäõ"],
            'ring-left': ["È≠îÊ≥ïÂÄº", "ÊîªÂáªÂäõ"],
            'ring-right': ["È≠îÊ≥ïÂÄº", "ÊîªÂáªÂäõ"],
            'amulet': ["È≠îÊ≥ïÂÄº", "Èò≤Âæ°Âäõ"],
            'badge': ["ÁîüÂëΩÂÄº", "È≠îÊ≥ïÂÄº"],
            'artefact': ["È≠îÊ≥ïÂÄº", "ÊîªÂáªÂäõ"]
        };

        // Ë£ÖÂ§áÈôÑÂä†Â±ûÊÄß
        const equipmentAdditionalAttributes = [
            "ÊîªÂáªÂäõÂä†Êàê", "Èò≤Âæ°ÂäõÂä†Êàê", "Êö¥ÂáªÁéá", "Êö¥Âáª‰º§ÂÆ≥", 
            "ÈáëÂ∏ÅÊéâËêΩÂä†Êàê", "ÁªèÈ™åÊéâËêΩÂä†Êàê", "Ê∞¥Êô∂ÊéâËêΩÂä†Êàê"
        ];

        // DOMÂÖÉÁ¥†ÂºïÁî®
        const elements = {
            tabs: document.querySelectorAll('.tab'),
            contents: document.querySelectorAll('.content'),
            battleLog: document.getElementById('battle-log'),
            inventoryGrid: document.getElementById('inventory-grid'),
            normalMaps: document.getElementById('normal-maps'),
            secretMaps: document.getElementById('secret-maps'),
            selectedEquipmentInfo: document.getElementById('selected-equipment-info'),
            reinforcePanel: document.getElementById('reinforce-panel'),
            evolvePanel: document.getElementById('evolve-panel'),
            resultModal: document.getElementById('result-modal'),
            awakeningModal: document.getElementById('awakening-modal'),
            wornEquipmentList: document.getElementById('worn-equipment-list'),
            battleOperationModal: document.getElementById('battle-operation-modal'),
            equipmentSelectionModal: document.getElementById('equipment-selection-modal'),
            equipmentSelectionGrid: document.getElementById('equipment-selection-grid')
        };

        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            loadGameData();
            updateUI();
            renderMaps();
            renderInventory();
            setupEventListeners();
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÁ¶ªÁ∫øÊî∂Áõä
            checkOfflineGains();
        }

        // Âä†ËΩΩÊ∏∏ÊàèÊï∞ÊçÆ
        function loadGameData() {
            const savedData = localStorage.getItem('textGameSave');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Ê£ÄÊü•Êï∞ÊçÆÁâàÊú¨ÂÖºÂÆπÊÄß
                if (data.version && data.version === "1.0") {
                    Object.assign(gameData, data.gameData);
                }
            }
        }

        // ‰øùÂ≠òÊ∏∏ÊàèÊï∞ÊçÆ
        function saveGameData() {
            const dataToSave = {
                version: "1.0",
                gameData: gameData
            };
            localStorage.setItem('textGameSave', JSON.stringify(dataToSave));
        }

        // Êõ¥Êñ∞UI
        function updateUI() {
            // Êõ¥Êñ∞ËßíËâ≤‰ø°ÊÅØ
            document.getElementById('character-level').textContent = gameData.character.level;
            document.getElementById('current-exp').textContent = gameData.character.exp;
            document.getElementById('required-exp').textContent = gameData.character.maxExp;
            document.getElementById('character-hp').textContent = gameData.character.derivedStats.hp;
            document.getElementById('character-mp').textContent = gameData.character.derivedStats.mp;
            document.getElementById('character-attack').textContent = gameData.character.derivedStats.attack;
            document.getElementById('character-defense').textContent = gameData.character.derivedStats.defense;
            document.getElementById('character-gold').textContent = gameData.character.gold;
            
            // Êõ¥Êñ∞Ê∞¥Êô∂ÊòæÁ§∫ÔºåÈôêÂà∂Â∞èÊï∞ÁÇπÂêé‰∏§‰Ωç
            document.getElementById('character-crystal').textContent = parseFloat(gameData.character.crystal.toFixed(2));
            
            // Êõ¥Êñ∞ÈôÑÂä†Â±ûÊÄß
            document.getElementById('character-crit-rate').textContent = `${gameData.character.derivedStats.critRate}%`;
            document.getElementById('character-crit-damage').textContent = `${gameData.character.derivedStats.critDamage}%`;
            document.getElementById('character-attack-bonus').textContent = `${gameData.character.derivedStats.attackBonus}%`;
            document.getElementById('character-defense-bonus').textContent = `${gameData.character.derivedStats.defenseBonus}%`;
            
            // Êõ¥Êñ∞ÁªèÈ™åÊù°
            const expPercentage = (gameData.character.exp / gameData.character.maxExp) * 100;
            document.getElementById('exp-progress').style.width = `${expPercentage}%`;
            
            // Êõ¥Êñ∞Ë£ÖÂ§áÊßΩ‰Ωç
            for (const slotId in gameData.equipment.slots) {
                const slotElement = document.getElementById(`${slotId}-content`);
                const equipment = gameData.equipment.slots[slotId];
                
                if (equipment) {
                    slotElement.innerHTML = `
                        <div class="equipment-item" data-id="${equipment.id}">
                            <div class="equipment-name">
                                <span class="quality quality-${equipment.quality}">${equipmentQuality[equipment.quality].name}</span> ${equipment.name}
                                ${equipment.reinforce > 0 ? `+${equipment.reinforce}` : ''}
                                ${equipment.evolve > 0 ? `‚òÖ${equipment.evolve}` : ''}
                            </div>
                            <div class="equipment-info">
                                ÈÉ®‰Ωç: ${equipmentSlots[equipment.slot]} | Á≠âÁ∫ß: ${equipment.level}
                            </div>
                            <div class="equipment-attrs">
                                ${equipment.baseAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                                ${equipment.additionalAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                            </div>
                            <button class="btn btn-outline btn-remove-equipment" data-slot="${slotId}">ËÑ±‰∏ã</button>
                        </div>
                    `;
                } else {
                    slotElement.innerHTML = 'Á©∫';
                }
            }
            
            // Êõ¥Êñ∞ÊàòÊñóÊó•Âøó
            while (elements.battleLog.children.length > 100) {
                elements.battleLog.removeChild(elements.battleLog.firstChild);
            }
            
            // Êõ¥Êñ∞ÈìÅÂå†Èì∫‰∏≠ÁöÑÁ©øÊà¥Ë£ÖÂ§áÂàóË°®
            renderWornEquipment();
            
            // Êõ¥Êñ∞ÈôÑÂä†Â±ûÊÄßÊòæÁ§∫
            document.getElementById('exp-bonus').textContent = `${gameData.character.derivedStats.expBonus}%`;
            document.getElementById('gold-bonus').textContent = `${gameData.character.derivedStats.goldBonus}%`;
            document.getElementById('crystal-bonus').textContent = `${gameData.character.derivedStats.crystalBonus}%`;
        }

        // Ê∏≤ÊüìÂú∞ÂõæÂàóË°®
        function renderMaps() {
            // Ê∏≤ÊüìÊôÆÈÄöÂú∞Âõæ
            elements.normalMaps.innerHTML = '';
            gameData.maps.normal.forEach(map => {
                const mapElement = document.createElement('div');
                mapElement.className = `map-item ${gameData.character.level < map.requiredPlayerLevel ? 'locked' : ''}`;
                
                // Â¶ÇÊûúÊòØÂ©¥ÂÑøÂç∑ÁéãÂú∞ÂõæÔºåÊ∑ªÂä†Á≠âÁ∫ßÈôêÂà∂ÊèêÁ§∫
                if (map.id === 0) {
                    mapElement.innerHTML = `
                        <div class="map-name">${map.name}</div>
                        <div class="map-info">
                            ÊÄ™Áâ©Á≠âÁ∫ß: ${map.minLevel}-${map.maxLevel}<br>
                            BOSSÁ≠âÁ∫ß: ${map.bossLevel}<br>
                            ÊéâËêΩË£ÖÂ§á: ${map.minEquipLevel}-${map.maxEquipLevel}Á∫ß<br>
                            ${gameData.character.level >= 3 ? 
                            `Á≠âÁ∫ß‚â•3Êó†Ê≥ïËøõÂÖ•` : 
                            `<button class="btn" data-map-id="${map.id}">ËøõÂÖ•Âú∞Âõæ</button>`}
                        </div>
                    `;
                } else {
                    mapElement.innerHTML = `
                        <div class="map-name">${map.name}</div>
                        <div class="map-info">
                            ÊÄ™Áâ©Á≠âÁ∫ß: ${map.minLevel}-${map.maxLevel}<br>
                            BOSSÁ≠âÁ∫ß: ${map.bossLevel}<br>
                            ÊéâËêΩË£ÖÂ§á: ${map.minEquipLevel}-${map.maxEquipLevel}Á∫ß<br>
                            ${gameData.character.level < map.requiredPlayerLevel ? 
                            `ÈúÄË¶ÅÁ≠âÁ∫ß: ${map.requiredPlayerLevel}` : 
                            `<button class="btn" data-map-id="${map.id}">ËøõÂÖ•Âú∞Âõæ</button>`}
                        </div>
                    `;
                }
                
                elements.normalMaps.appendChild(mapElement);
            });
            
            // Ê∏≤ÊüìÁßòÂ¢ÉÂú∞Âõæ
            elements.secretMaps.innerHTML = '';
            gameData.maps.secret.forEach(map => {
                const mapElement = document.createElement('div');
                mapElement.className = `map-item ${gameData.character.level < map.requiredPlayerLevel ? 'locked' : ''}`;
                mapElement.innerHTML = `
                    <div class="map-name">${map.name}</div>
                    <div class="map-info">
                        ÊÄ™Áâ©Á≠âÁ∫ß: ${map.minLevel}-${map.maxLevel}<br>
                        BOSSÁ≠âÁ∫ß: ${map.bossLevel}<br>
                        ÊéâËêΩË£ÖÂ§á: ${map.minEquipLevel}-${map.maxEquipLevel}Á∫ß<br>
                        ${gameData.character.level < map.requiredPlayerLevel ? 
                        `ÈúÄË¶ÅÁ≠âÁ∫ß: ${map.requiredPlayerLevel}` : 
                        `<button class="btn" data-map-id="${map.id}">ËøõÂÖ•Âú∞Âõæ</button>`}
                    </div>
                `;
                elements.secretMaps.appendChild(mapElement);
            });
        }

        // Ê∏≤ÊüìËÉåÂåÖ
        function renderInventory() {
            elements.inventoryGrid.innerHTML = '';
            
            gameData.equipment.inventory.forEach(equipment => {
                const equipmentElement = document.createElement('div');
                equipmentElement.className = `equipment-item ${equipment.locked ? 'locked' : ''} ${equipment.equipped ? 'selected' : ''}`;
                equipmentElement.dataset.id = equipment.id;
                
                equipmentElement.innerHTML = `
                    <div class="equipment-name">
                        <span class="quality quality-${equipment.quality}">${equipmentQuality[equipment.quality].name}</span> ${equipment.name}
                        ${equipment.reinforce > 0 ? `+${equipment.reinforce}` : ''}
                        ${equipment.evolve > 0 ? `‚òÖ${equipment.evolve}` : ''}
                    </div>
                    <div class="equipment-info">
                        ÈÉ®‰Ωç: ${equipmentSlots[equipment.slot]} | Á≠âÁ∫ß: ${equipment.level}
                    </div>
                    <div class="equipment-attrs">
                        ${equipment.baseAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                        ${equipment.additionalAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                    </div>
                    <div>
                        ${equipment.equipped ? '<button class="btn btn-outline btn-unequip">ËÑ±‰∏ã</button>' : '<button class="btn btn-outline btn-wear">Á©øÊà¥</button>'}
                        ${equipment.locked ? '<button class="btn btn-outline btn-unlock">Ëß£ÈîÅ</button>' : '<button class="btn btn-outline btn-lock">ÈîÅÂÆö</button>'}
                        <button class="btn btn-outline btn-sell">ÂîÆÂçñ</button>
                    </div>
                `;
                
                elements.inventoryGrid.appendChild(equipmentElement);
            });
        }

        // Ê∏≤ÊüìÁ©øÊà¥ÁöÑË£ÖÂ§áÂàóË°®ÔºàÁî®‰∫éÈìÅÂå†Èì∫Ôºâ
        function renderWornEquipment() {
            elements.wornEquipmentList.innerHTML = '';
            
            for (const slotId in gameData.equipment.slots) {
                const equipment = gameData.equipment.slots[slotId];
                if (equipment) {
                    const equipmentElement = document.createElement('div');
                    equipmentElement.className = 'equipment-item';
                    equipmentElement.dataset.id = equipment.id;
                    
                    equipmentElement.innerHTML = `
                        <div class="equipment-name">
                            <span class="quality quality-${equipment.quality}">${equipmentQuality[equipment.quality].name}</span> ${equipment.name}
                            ${equipment.reinforce > 0 ? `+${equipment.reinforce}` : ''}
                            ${equipment.evolve > 0 ? `‚òÖ${equipment.evolve}` : ''}
                        </div>
                        <div class="equipment-info">
                            ÈÉ®‰Ωç: ${equipmentSlots[equipment.slot]} | Á≠âÁ∫ß: ${equipment.level}
                        </div>
                        <div class="equipment-attrs">
                            ${equipment.baseAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                            ${equipment.additionalAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                        </div>
                        <div>
                            <button class="btn btn-outline btn-select-equipment" data-slot="${slotId}">ÈÄâÊã©</button>
                        </div>
                    `;
                    
                    elements.wornEquipmentList.appendChild(equipmentElement);
                }
            }
        }

        // ÁîüÊàêÈöèÊú∫Ë£ÖÂ§á
        function generateEquipment(slot, level, quality) {
            const qualityData = equipmentQuality[quality];
            const baseAttributes = equipmentBaseAttributes[slot];
            
            // ÁîüÊàêÂü∫Á°ÄÂ±ûÊÄßÂÄºÔºåÊ†πÊçÆË£ÖÂ§áÁ≠âÁ∫ßÂíåÂìÅË¥®
            const baseAttrValues = baseAttributes.map(attr => {
                if (attr.includes("ÊîªÂáªÂäõ")) {
                    const baseValue = Math.floor(level * 2);
                    const qualityMultiplier = qualityData.baseMultiplier;
                    return `${attr}: +${Math.floor(baseValue * qualityMultiplier)}`;
                } else if (attr.includes("Èò≤Âæ°Âäõ")) {
                    const baseValue = Math.floor(level * 1.5);
                    const qualityMultiplier = qualityData.baseMultiplier;
                    return `${attr}: +${Math.floor(baseValue * qualityMultiplier)}`;
                } else if (attr.includes("ÁîüÂëΩÂÄº")) {
                    const baseValue = Math.floor(level * 5);
                    const qualityMultiplier = qualityData.baseMultiplier;
                    return `${attr}: +${Math.floor(baseValue * qualityMultiplier)}`;
                } else if (attr.includes("È≠îÊ≥ïÂÄº")) {
                    const baseValue = Math.floor(level * 3);
                    const qualityMultiplier = qualityData.baseMultiplier;
                    return `${attr}: +${Math.floor(baseValue * qualityMultiplier)}`;
                }
            });
            
            // ÁîüÊàêÈôÑÂä†Â±ûÊÄßÔºåÊ†πÊçÆÂìÅË¥®
            const additionalCount = Math.min(
                qualityData.additionalCount,
                8 // ÊúÄÂ§ß8Êù°
            );
            
            const additionalAttributes = [];
            for (let i = 0; i < additionalCount; i++) {
                const attrType = equipmentAdditionalAttributes[Math.floor(Math.random() * equipmentAdditionalAttributes.length)];
                let value;
                
                if (attrType.includes("Âä†Êàê") || attrType.includes("Áéá")) {
                    const baseValue = Math.floor(Math.random() * 10) + 1;
                    const qualityMultiplier = qualityData.baseMultiplier;
                    value = `${attrType}: +${Math.floor(baseValue * qualityMultiplier)}%`;
                } else {
                    const baseValue = Math.floor(Math.random() * 5) + 1;
                    const qualityMultiplier = qualityData.baseMultiplier;
                    value = `${attrType}: +${Math.floor(baseValue * qualityMultiplier)}`;
                }
                
                additionalAttributes.push(value);
            }
            
            // ÁîüÊàêË£ÖÂ§áÂêçÁß∞
            const names = [
                "ÂãáËÄÖ", "ÂäõÈáè", "ÊïèÊç∑", "Êô∫ÊÖß", "ÂÆàÊä§", "ÊØÅÁÅ≠", "Á•ûÂú£", "ÊöóÂΩ±", 
                "ÁÅ´ÁÑ∞", "ÂÜ∞Èúú", "Èõ∑ÈúÜ", "Ëá™ÁÑ∂", "ÊöóÈªë", "ÂÖâÊòé", "Ê∑∑Ê≤å", "Áß©Â∫è"
            ];
            
            const name = `${names[Math.floor(Math.random() * names.length)]}${slot.replace(/-/g, "")}`;
            
            return {
                id: Date.now() + Math.floor(Math.random() * 1000),
                slot: slot,
                name: name,
                quality: quality,
                level: level,
                baseAttributes: baseAttrValues,
                additionalAttributes: additionalAttributes,
                locked: false,
                equipped: false,
                reinforce: 0,
                evolve: 0
            };
        }

        // ÂºÄÂßãÊàòÊñó
        function startBattle(mapId) {
            // ÂÅúÊ≠¢‰πãÂâçÁöÑÊàòÊñó
            if (gameData.battleInterval) {
                clearInterval(gameData.battleInterval);
            }
            
            // Êü•ÊâæÂú∞Âõæ
            let map = null;
            gameData.maps.normal.forEach(m => {
                if (m.id === mapId) map = m;
            });
            
            if (!map) {
                gameData.maps.secret.forEach(m => {
                    if (m.id === mapId) map = m;
                });
            }
            
            if (!map) return;
            
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÂ©¥ÂÑøÂç∑ÁéãÂú∞ÂõæÔºå‰∏îÁé©ÂÆ∂Á≠âÁ∫ß‚â•3Êó∂Êó†Ê≥ïËøõÂÖ•
            if (map.id === 0 && gameData.character.level >= 3) {
                addBattleLog("‰Ω†ÁöÑÁ≠âÁ∫ßÂ∑≤ËææÂà∞3Á∫ßÔºåÊó†Ê≥ïËøõÂÖ•Â©¥ÂÑøÂç∑ÁéãÂú∞Âõæ");
                return;
            }
            
            gameData.currentMap = map;
            
            // ÂºÄÂßãÊàòÊñóÂæ™ÁéØ
            gameData.battleInterval = setInterval(() => {
                battle();
            }, gameData.battleSpeed);
        }

        // ÊàòÊñóÂáΩÊï∞
        function battle() {
            const map = gameData.currentMap;
            
            // Âà§Êñ≠ÊòØÊôÆÈÄöÊÄ™Áâ©ËøòÊòØBOSS
            let monsterLevel;
            if (map.id === 0) { // Â©¥ÂÑøÂç∑ÁéãÂú∞Âõæ
                monsterLevel = 1; // Âº∫Âà∂ÊÄ™Áâ©Á≠âÁ∫ß‰∏∫1
            } else {
                const isBoss = Math.random() < 0.05; // 5%Âá†ÁéáÈÅáÂà∞BOSS
                if (isBoss) {
                    monsterLevel = map.bossLevel;
                } else {
                    monsterLevel = Math.floor(Math.random() * (map.maxLevel - map.minLevel + 1)) + map.minLevel;
                }
            }
            
            // Ê†πÊçÆÁ≠âÁ∫ßË∞ÉÊï¥ÊÄ™Áâ©Â±ûÊÄß
            let attack, defense, hp;
            
            if (monsterLevel >= 11) {
                if (monsterLevel === map.bossLevel && map.id !== 0) {
                    // BOSSÂ±ûÊÄß
                    attack = 25 * monsterLevel;
                    defense = 30 * monsterLevel;
                    hp = 50 * monsterLevel;
                } else {
                    // ÊôÆÈÄöÊÄ™Áâ©Â±ûÊÄß
                    attack = 15 * monsterLevel;
                    defense = 18 * monsterLevel;
                    hp = 30 * monsterLevel;
                }
            } else {
                // 1-10Á∫ßÊÄ™Áâ©Â±ûÊÄß‰øùÊåÅ‰∏çÂèò
                attack = Math.floor(2.5 * monsterLevel);
                defense = Math.floor(2.5 * monsterLevel);
                hp = Math.floor(6 * monsterLevel);
            }
            
            // ÂàõÂª∫ÊÄ™Áâ©ÂØπË±°
            const monster = {
                level: monsterLevel,
                attack: attack,
                defense: defense,
                hp: hp,
                isBoss: monsterLevel === map.bossLevel
            };
            
            // ËÆ°ÁÆóÊàòÊñóÁªìÊûú
            const playerAttack = gameData.character.derivedStats.attack;
            const playerDefense = gameData.character.derivedStats.defense;
            
            // ÁÆÄÂåñÊàòÊñóÈÄªËæëÔºåÁõ¥Êé•ËÆ°ÁÆó‰º§ÂÆ≥
            const damage = Math.max(1, playerAttack - monster.defense);
            const monsterDamage = Math.max(1, monster.attack - playerDefense);
            
            // ËÆ°ÁÆóÊàòÊñóËΩÆÊï∞
            const rounds = Math.ceil(monster.hp / damage);
            const playerHpLost = Math.min(monsterDamage * rounds, gameData.character.derivedStats.hp);
            
            // ÊàòÊñóÊó•Âøó
            addBattleLog(`ÈÅáÂà∞${map.name}ÁöÑ${monster.isBoss ? 'BOSS' : 'ÊÄ™Áâ©'}ÔºåÁ≠âÁ∫ß${monster.level}ÔºåÊîªÂáªÂäõ${monster.attack}ÔºåÈò≤Âæ°Âäõ${monster.defense}ÔºåÁîüÂëΩÂÄº${monster.hp}`);
            
            if (playerHpLost >= gameData.character.derivedStats.hp) {
                // Áé©ÂÆ∂Ê≠ª‰∫°
                addBattleLog(`‰Ω†Ë¢´ÂáªË¥•‰∫ÜÔºÅ2ÁßíÂêéÂ§çÊ¥ª...`);
                clearInterval(gameData.battleInterval);
                gameData.currentMap = null;
                setTimeout(() => {
                    startBattle(map.id);
                }, 2000); // Â§çÊ¥ªÊó∂Èó¥‰øÆÊîπ‰∏∫2Áßí
            } else {
                // Áé©ÂÆ∂ËÉúÂà©
                // ËÆ°ÁÆóÂü∫Á°ÄÁªèÈ™åÂíåÈáëÂ∏Å
                let expGain = Math.floor(monster.level * 10);
                let goldGain = Math.floor(monster.level * 5);
                
                // Â∫îÁî®ÁªèÈ™åÊéâËêΩÂä†Êàê
                const expBonus = parseFloat(gameData.character.derivedStats.expBonus || 0);
                expGain = Math.floor(expGain * (1 + expBonus / 100));
                
                // Â∫îÁî®ÈáëÂ∏ÅÊéâËêΩÂä†Êàê
                const goldBonus = parseFloat(gameData.character.derivedStats.goldBonus || 0);
                goldGain = Math.floor(goldGain * (1 + goldBonus / 100));
                
                gameData.character.exp += expGain;
                gameData.character.gold += goldGain;
                
                addBattleLog(`ÂáªË¥•‰∫Ü${monster.isBoss ? 'BOSS' : 'ÊÄ™Áâ©'}ÔºåËé∑Âæó${expGain}ÁªèÈ™åÔºå${goldGain}ÈáëÂ∏Å`);
                
                // Ê£ÄÊü•ÊòØÂê¶ÂçáÁ∫ß
                checkLevelUp();
                
                // ÊéâËêΩÁâ©ÂìÅ
                if (Math.random() < 0.1) { // 10%Âá†ÁéáÊéâËêΩË£ÖÂ§á
                    const equipLevel = monster.level;
                    const qualityRoll = Math.random();
                    let quality = 'common';
                    
                    // Ê†πÊçÆÊ¶ÇÁéáÈÄâÊã©ÂìÅË¥®
                    let cumulativeRate = 0;
                    for (const q in equipmentQuality) {
                        cumulativeRate += equipmentQuality[q].dropRate;
                        if (qualityRoll <= cumulativeRate) {
                            quality = q;
                            break;
                        }
                    }
                    
                    const equipment = generateEquipment(
                        Object.keys(equipmentSlots)[Math.floor(Math.random() * Object.keys(equipmentSlots).length)],
                        equipLevel,
                        quality
                    );
                    
                    // Ê£ÄÊü•ÊòØÂê¶Á¨¶ÂêàËá™Âä®ÂîÆÂçñÊù°‰ª∂
                    if (equipment.quality <= gameData.autoSellSettings.quality && equipment.level <= gameData.autoSellSettings.level) {
                        // ËÆ°ÁÆóÂîÆÂçñ‰ª∑Ê†º
                        let basePrice = equipment.level * 10;
                        let qualityMultiplier = 1;
                        
                        switch (equipment.quality) {
                            case 'uncommon': qualityMultiplier = 1.5; break;
                            case 'rare': qualityMultiplier = 2; break;
                            case 'epic': qualityMultiplier = 3; break;
                            case 'legendary': qualityMultiplier = 5; break;
                            case 'mythic': qualityMultiplier = 10; break;
                        }
                        
                        const sellPrice = Math.floor(basePrice * qualityMultiplier);
                        gameData.character.gold += sellPrice;
                        
                        addBattleLog(`Ëá™Âä®ÂîÆÂçñ‰∫Ü${equipmentQuality[equipment.quality].name}Ë£ÖÂ§áÔºö${equipment.name}ÔºåËé∑Âæó${sellPrice}ÈáëÂ∏Å`);
                    } else {
                        gameData.equipment.inventory.push(equipment);
                        addBattleLog(`Ëé∑Âæó‰∫Ü${equipmentQuality[equipment.quality].name}Ë£ÖÂ§áÔºö${equipment.name}`);
                        renderInventory();
                    }
                }
                
                // ÊéâËêΩÊ∞¥Êô∂
                if (Math.random() < 0.02) { // 2%Âá†ÁéáÊéâËêΩÊ∞¥Êô∂
                    let crystalGain = monster.isBoss ? Math.floor(Math.random() * 3) + 1 : Math.random() < 0.5 ? 0.01 : 0.05;
                    
                    // Â∫îÁî®Ê∞¥Êô∂ÊéâËêΩÂä†Êàê
                    const crystalBonus = parseFloat(gameData.character.derivedStats.crystalBonus || 0);
                    crystalGain = crystalBonus > 0 ? crystalGain * (1 + crystalBonus / 100) : crystalGain;
                    
                    gameData.character.crystal += crystalGain;
                    addBattleLog(`Ëé∑Âæó‰∫Ü${crystalGain.toFixed(2)}Ê∞¥Êô∂`);
                }
            }
            
            // ÂÆûÊó∂‰øùÂ≠òÊ∏∏ÊàèÊï∞ÊçÆ
            saveGameData();
            
            // Êõ¥Êñ∞UI
            updateUI();
        }

        // Ê∑ªÂä†ÊàòÊñóÊó•Âøó
        function addBattleLog(message) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = message;
            
            elements.battleLog.appendChild(logEntry);
            elements.battleLog.scrollTop = elements.battleLog.scrollHeight;
            
            // ‰øùÂ≠òÂà∞Ê∏∏ÊàèÊï∞ÊçÆ
            gameData.battleLog.push(message);
        }

        // Ê£ÄÊü•ÂçáÁ∫ß
        function checkLevelUp() {
            while (gameData.character.exp >= gameData.character.maxExp && gameData.character.level < 200) {
                gameData.character.level++;
                gameData.character.exp -= gameData.character.maxExp;
                gameData.character.maxExp = gameData.character.level * gameData.character.level * 100;
                
                // Êõ¥Êñ∞Â±ûÊÄß
                updateDerivedStats();
                
                // Ê£ÄÊü•ÊòØÂê¶ËææÂà∞200Á∫ß
                if (gameData.character.level === 200) {
                    showAwakeningModal();
                }
                
                addBattleLog(`ÊÅ≠ÂñúÔºÅÂçáÁ∫ßÂà∞${gameData.character.level}Á∫ßÔºÅ`);
                
                // Êõ¥Êñ∞UI
                updateUI();
            }
        }

        // Êõ¥Êñ∞Ë°çÁîüÂ±ûÊÄß
        function updateDerivedStats() {
            const level = gameData.character.level;
            
            // ÂàùÂßãÂåñÂü∫Á°ÄÂ±ûÊÄß
            let attack = 5;
            let defense = 5;
            let hp = 30;
            let mp = 30;
            
            // ÈÅçÂéÜË£ÖÂ§áÊßΩ‰Ωç
            for (const slotId in gameData.equipment.slots) {
                const equipment = gameData.equipment.slots[slotId];
                if (!equipment) continue;
                
                // Ëß£ÊûêÂü∫Á°ÄÂ±ûÊÄß
                equipment.baseAttributes.forEach(attr => {
                    if (attr.includes("ÊîªÂáªÂäõ")) {
                        const value = parseInt(attr.match(/\d+/)[0]);
                        attack += value;
                    } else if (attr.includes("Èò≤Âæ°Âäõ")) {
                        const value = parseInt(attr.match(/\d+/)[0]);
                        defense += value;
                    } else if (attr.includes("ÁîüÂëΩÂÄº")) {
                        const value = parseInt(attr.match(/\d+/)[0]);
                        hp += value;
                    } else if (attr.includes("È≠îÊ≥ïÂÄº")) {
                        const value = parseInt(attr.match(/\d+/)[0]);
                        mp += value;
                    }
                });
            }
            
            // ÂàùÂßãÂåñÂä†ÊàêÂ±ûÊÄß
            gameData.character.derivedStats.expBonus = 0;
            gameData.character.derivedStats.goldBonus = 0;
            gameData.character.derivedStats.crystalBonus = 0;
            gameData.character.derivedStats.critRate = 0;
            gameData.character.derivedStats.critDamage = 0;
            gameData.character.derivedStats.attackBonus = 0;
            gameData.character.derivedStats.defenseBonus = 0;
            
            // ÈÅçÂéÜË£ÖÂ§áÊßΩ‰ΩçÔºåÊõ¥Êñ∞ÈôÑÂä†Â±ûÊÄß
            for (const slotId in gameData.equipment.slots) {
                const equipment = gameData.equipment.slots[slotId];
                if (!equipment) continue;
                
                // Ëß£ÊûêÈôÑÂä†Â±ûÊÄß
                equipment.additionalAttributes.forEach(attr => {
                    if (attr.includes("ÁªèÈ™åÊéâËêΩÂä†Êàê")) {
                        const percentage = parseInt(attr.match(/\d+/)[0]);
                        gameData.character.derivedStats.expBonus += percentage;
                    } else if (attr.includes("ÈáëÂ∏ÅÊéâËêΩÂä†Êàê")) {
                        const percentage = parseInt(attr.match(/\d+/)[0]);
                        gameData.character.derivedStats.goldBonus += percentage;
                    } else if (attr.includes("Ê∞¥Êô∂ÊéâËêΩÂä†Êàê")) {
                        const percentage = parseInt(attr.match(/\d+/)[0]);
                        gameData.character.derivedStats.crystalBonus += percentage;
                    } else if (attr.includes("Êö¥ÂáªÁéá")) {
                        const percentage = parseInt(attr.match(/\d+/)[0]);
                        gameData.character.derivedStats.critRate += percentage;
                    } else if (attr.includes("Êö¥Âáª‰º§ÂÆ≥")) {
                        const percentage = parseInt(attr.match(/\d+/)[0]);
                        gameData.character.derivedStats.critDamage += percentage;
                    } else if (attr.includes("ÊîªÂáªÂäõÂä†Êàê")) {
                        const percentage = parseInt(attr.match(/\d+/)[0]);
                        gameData.character.derivedStats.attackBonus += percentage;
                    } else if (attr.includes("Èò≤Âæ°ÂäõÂä†Êàê")) {
                        const percentage = parseInt(attr.match(/\d+/)[0]);
                        gameData.character.derivedStats.defenseBonus += percentage;
                    }
                });
            }
            
            // Â∫îÁî®ÁôæÂàÜÊØîÂä†ÊàêÂà∞Âü∫Á°ÄÂ±ûÊÄß
            attack = Math.floor(attack * (1 + gameData.character.derivedStats.attackBonus / 100));
            defense = Math.floor(defense * (1 + gameData.character.derivedStats.defenseBonus / 100));
            
            // Êõ¥Êñ∞Ë°çÁîüÂ±ûÊÄß
            gameData.character.derivedStats.attack = attack;
            gameData.character.derivedStats.defense = defense;
            gameData.character.derivedStats.hp = hp;
            gameData.character.derivedStats.mp = mp;
            
            // Êõ¥Êñ∞UI
            updateUI();
        }

        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function setupEventListeners() {
            // Ê†áÁ≠æÂàáÊç¢
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.dataset.tab;
                    
                    // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
                    elements.tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
                    elements.contents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabId) {
                            content.classList.add('active');
                        }
                    });
                    
                    // ÁâπÊÆäÂÜÖÂÆπÊõ¥Êñ∞
                    if (tabId === 'inventory') {
                        renderInventory();
                    } else if (tabId === 'equipment') {
                        updateUI();
                    } else if (tabId === 'blacksmith') {
                        renderWornEquipment();
                    }
                });
            });
            
            // Âú∞ÂõæÁÇπÂáª‰∫ã‰ª∂
            document.addEventListener('click', (e) => {
                if (e.target && e.target.classList.contains('btn') && e.target.dataset.mapId) {
                    const mapId = parseInt(e.target.dataset.mapId);
                    startBattle(mapId);
                }
            });
            
            // Ë£ÖÂ§áÁ©øÊà¥/ËÑ±‰∏ã
            document.addEventListener('click', (e) => {
                // Ê£ÄÊü•ÊòØÂê¶Â§Ñ‰∫éÊàòÊñóÁä∂ÊÄÅ
                if (gameData.battleInterval) {
                    if (e.target && (e.target.classList.contains('btn-wear') || e.target.classList.contains('btn-unequip') || e.target.classList.contains('btn-remove-equipment'))) {
                        showBattleOperationModal();
                        return;
                    }
                }
                
                if (e.target && e.target.classList.contains('btn-wear')) {
                    const equipmentElement = e.target.closest('.equipment-item');
                    const equipmentId = parseInt(equipmentElement.dataset.id);
                    const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                    
                    if (equipment) {
                        // Ê£ÄÊü•Ë£ÖÂ§áÁ≠âÁ∫ßÊòØÂê¶È´ò‰∫éËßíËâ≤Á≠âÁ∫ß
                        if (equipment.level > gameData.character.level) {
                            addBattleLog(`Ë£ÖÂ§áÁ≠âÁ∫ß${equipment.level}È´ò‰∫é‰Ω†ÁöÑËßíËâ≤Á≠âÁ∫ß${gameData.character.level}ÔºåÊó†Ê≥ïÁ©øÊà¥`);
                            return;
                        }
                        
                        // Ê£ÄÊü•ËØ•ÈÉ®‰ΩçÊòØÂê¶Â∑≤ÊúâË£ÖÂ§á
                        if (gameData.equipment.slots[equipment.slot]) {
                            addBattleLog(`ËØ•ÈÉ®‰ΩçÂ∑≤ÊúâË£ÖÂ§áÔºåÊó†Ê≥ïÁ©øÊà¥`);
                            return;
                        }
                        
                        // Á©øÊà¥Êñ∞Ë£ÖÂ§á
                        gameData.equipment.slots[equipment.slot] = equipment;
                        equipment.equipped = true;
                        
                        // Êõ¥Êñ∞Â±ûÊÄß
                        updateDerivedStats();
                        renderInventory();
                        
                        // Ëá™Âä®‰øùÂ≠ò
                        saveGameData();
                    }
                } else if (e.target && e.target.classList.contains('btn-unequip')) {
                    const equipmentElement = e.target.closest('.equipment-item');
                    const equipmentId = parseInt(equipmentElement.dataset.id);
                    const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                    
                    if (equipment) {
                        // ËÑ±‰∏ãË£ÖÂ§á
                        equipment.equipped = false;
                        gameData.equipment.slots[equipment.slot] = null;
                        
                        // Êõ¥Êñ∞Â±ûÊÄß
                        updateDerivedStats();
                        
                        addBattleLog(`ËÑ±‰∏ã‰∫Ü${equipment.name}`);
                        renderInventory();
                        
                        // Ëá™Âä®‰øùÂ≠ò
                        saveGameData();
                    }
                } else if (e.target && e.target.classList.contains('btn-remove-equipment')) {
                    const equipmentElement = e.target.closest('.equipment-item');
                    const equipmentId = parseInt(equipmentElement.dataset.id);
                    
                    // ÊâæÂà∞Ë£ÖÂ§áÊâÄÂú®ÁöÑÊßΩ‰Ωç
                    let slotId = null;
                    for (const slot in gameData.equipment.slots) {
                        if (gameData.equipment.slots[slot] && gameData.equipment.slots[slot].id === equipmentId) {
                            slotId = slot;
                            break;
                        }
                    }
                    
                    if (slotId) {
                        const equipment = gameData.equipment.slots[slotId];
                        
                        // ËÑ±‰∏ãË£ÖÂ§á
                        equipment.equipped = false;
                        gameData.equipment.slots[slotId] = null;
                        
                        // Êõ¥Êñ∞Â±ûÊÄß
                        updateDerivedStats();
                        
                        addBattleLog(`ËÑ±‰∏ã‰∫Ü${equipment.name}`);
                        updateUI();
                        
                        // Ëá™Âä®‰øùÂ≠ò
                        saveGameData();
                    } else {
                        addBattleLog('Êú™ÊâæÂà∞ÂØπÂ∫îÁöÑË£ÖÂ§áÊßΩ‰Ωç');
                    }
                }
            });
            
            // ÈîÅÂÆö/Ëß£ÈîÅË£ÖÂ§á
            document.addEventListener('click', (e) => {
                if (e.target && e.target.classList.contains('btn-lock')) {
                    const equipmentElement = e.target.closest('.equipment-item');
                    const equipmentId = parseInt(equipmentElement.dataset.id);
                    const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                    
                    if (equipment) {
                        equipment.locked = true;
                        e.target.textContent = 'Ëß£ÈîÅ';
                        renderInventory();
                    }
                } else if (e.target && e.target.classList.contains('btn-unlock')) {
                    const equipmentElement = e.target.closest('.equipment-item');
                    const equipmentId = parseInt(equipmentElement.dataset.id);
                    const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                    
                    if (equipment) {
                        equipment.locked = false;
                        e.target.textContent = 'ÈîÅÂÆö';
                        renderInventory();
                    }
                }
            });
            
            // ÂîÆÂçñË£ÖÂ§á
            document.addEventListener('click', (e) => {
                if (e.target && e.target.classList.contains('btn-sell')) {
                    const equipmentElement = e.target.closest('.equipment-item');
                    const equipmentId = parseInt(equipmentElement.dataset.id);
                    const equipmentIndex = gameData.equipment.inventory.findIndex(e => e.id === equipmentId);
                    
                    if (equipmentIndex !== -1 && !gameData.equipment.inventory[equipmentIndex].locked) {
                        const equipment = gameData.equipment.inventory[equipmentIndex];
                        
                        // ËÆ°ÁÆóÂîÆÂçñ‰ª∑Ê†º
                        let basePrice = equipment.level * 10;
                        let qualityMultiplier = 1;
                        
                        switch (equipment.quality) {
                            case 'uncommon': qualityMultiplier = 1.5; break;
                            case 'rare': qualityMultiplier = 2; break;
                            case 'epic': qualityMultiplier = 3; break;
                            case 'legendary': qualityMultiplier = 5; break;
                            case 'mythic': qualityMultiplier = 10; break;
                        }
                        
                        const sellPrice = Math.floor(basePrice * qualityMultiplier);
                        gameData.character.gold += sellPrice;
                        
                        // ‰ªéËÉåÂåÖ‰∏≠ÁßªÈô§
                        gameData.equipment.inventory.splice(equipmentIndex, 1);
                        
                        // Â¶ÇÊûúË£ÖÂ§áÊ≠£Âú®Á©øÊà¥Ôºå‰ªéË£ÖÂ§áÊßΩ‰∏≠ÁßªÈô§
                        if (equipment.equipped) {
                            gameData.equipment.slots[equipment.slot] = null;
                            updateDerivedStats();
                        }
                        
                        addBattleLog(`ÂîÆÂçñ‰∫Ü${equipment.name}ÔºåËé∑Âæó${sellPrice}ÈáëÂ∏Å`);
                        updateUI();
                        renderInventory();
                        
                        // Ëá™Âä®‰øùÂ≠ò
                        saveGameData();
                    }
                }
            });
            
            // ‰∏ÄÈîÆÂîÆÂçñÊâÄÊúâË£ÖÂ§á
            document.getElementById('sell-all-btn').addEventListener('click', () => {
                let totalGold = 0;
                
                // Á≠õÈÄâÂèØÂîÆÂçñÁöÑË£ÖÂ§á
                const sellableEquipment = gameData.equipment.inventory.filter(equipment => {
                    return !equipment.locked && !equipment.equipped && 
                           equipment.quality <= gameData.autoSellSettings.quality && 
                           equipment.level <= gameData.autoSellSettings.level;
                });
                
                // ÂîÆÂçñË£ÖÂ§á
                sellableEquipment.forEach(equipment => {
                    let basePrice = equipment.level * 10;
                    let qualityMultiplier = 1;
                    
                    switch (equipment.quality) {
                        case 'uncommon': qualityMultiplier = 1.5; break;
                        case 'rare': qualityMultiplier = 2; break;
                        case 'epic': qualityMultiplier = 3; break;
                        case 'legendary': qualityMultiplier = 5; break;
                        case 'mythic': qualityMultiplier = 10; break;
                    }
                    
                    const sellPrice = Math.floor(basePrice * qualityMultiplier);
                    totalGold += sellPrice;
                    
                    // ‰ªéËÉåÂåÖ‰∏≠ÁßªÈô§
                    const index = gameData.equipment.inventory.findIndex(e => e.id === equipment.id);
                    if (index !== -1) {
                        gameData.equipment.inventory.splice(index, 1);
                    }
                });
                
                // Êõ¥Êñ∞ÈáëÂ∏Å
                gameData.character.gold += totalGold;
                
                addBattleLog(`‰∏ÄÈîÆÂîÆÂçñ‰∫Ü${sellableEquipment.length}‰ª∂Ë£ÖÂ§áÔºåËé∑Âæó${totalGold}ÈáëÂ∏Å`);
                updateUI();
                renderInventory();
                
                // Ëá™Âä®‰øùÂ≠ò
                saveGameData();
            });
            
            // Ëá™Âä®ÂîÆÂçñËÆæÁΩÆ
            document.getElementById('save-auto-sell-settings').addEventListener('click', () => {
                gameData.autoSellSettings.quality = document.getElementById('auto-sell-quality').value;
                gameData.autoSellSettings.level = parseInt(document.getElementById('auto-sell-level').value);
                
                addBattleLog(`Ëá™Âä®ÂîÆÂçñËÆæÁΩÆÂ∑≤Êõ¥Êñ∞ÔºöÂìÅË¥®‰Ωé‰∫éÁ≠â‰∫é${equipmentQuality[gameData.autoSellSettings.quality].name}ÔºåÁ≠âÁ∫ß‰Ωé‰∫é${gameData.autoSellSettings.level}`);
            });
            
            // ÈÄâÊã©Ë£ÖÂ§áËøõË°åÂº∫ÂåñÊàñËøõÂåñ
            document.addEventListener('click', (e) => {
                if (e.target && e.target.classList.contains('btn-select-equipment')) {
                    // Ê∏ÖÈô§‰πãÂâçÁöÑÈÄâÊã©
                    document.querySelectorAll('.equipment-item.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // ÈÄâ‰∏≠ÂΩìÂâçË£ÖÂ§á
                    const equipmentElement = e.target.closest('.equipment-item');
                    equipmentElement.classList.add('selected');
                    
                    const equipmentId = parseInt(equipmentElement.dataset.id);
                    const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                    
                    if (equipment) {
                        // Êõ¥Êñ∞Âº∫ÂåñÂíåËøõÂåñÈù¢Êùø
                        document.getElementById('current-reinforce').textContent = equipment.reinforce;
                        document.getElementById('reinforce-cost').textContent = Math.floor(100 * Math.pow(1.1, equipment.reinforce));
                        
                        document.getElementById('current-evolve').textContent = equipment.evolve;
                        document.getElementById('evolve-cost').textContent = 1; // ÊØèÊ¨°ËøõÂåñÊ∂àËÄó1Âç∑
                        
                        // ÊòæÁ§∫Âº∫ÂåñÂíåËøõÂåñÈù¢Êùø
                        document.getElementById('reinforce-panel').style.display = 'block';
                        document.getElementById('evolve-panel').style.display = 'block';
                    }
                }
            });
            
            // Âº∫ÂåñË£ÖÂ§á
            document.getElementById('do-reinforce').addEventListener('click', () => {
                const selectedEquipment = document.querySelector('.equipment-item.selected');
                if (!selectedEquipment) {
                    addBattleLog('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰ª∂Ë£ÖÂ§áËøõË°åÂº∫Âåñ');
                    return;
                }
                
                const equipmentId = parseInt(selectedEquipment.dataset.id);
                const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                
                if (!equipment) return;
                
                // Ê£ÄÊü•ÊòØÂê¶Â§Ñ‰∫éÊàòÊñóÁä∂ÊÄÅ
                if (gameData.battleInterval) {
                    showBattleOperationModal();
                    return;
                }
                
                // ËÆ°ÁÆóÂº∫ÂåñÊàêÊú¨
                const cost = Math.floor(100 * Math.pow(1.1, equipment.reinforce));
                
                if (gameData.character.gold < cost) {
                    showResultModal(`Âº∫ÂåñÂ§±Ë¥•ÔºöÈáëÂ∏Å‰∏çË∂≥ÔºåÈúÄË¶Å${cost}ÈáëÂ∏Å`, 'danger');
                    return;
                }
                
                // Êâ£Èô§ÈáëÂ∏Å
                gameData.character.gold -= cost;
                
                // Âº∫ÂåñÁªìÊûú
                const success = Math.random() < 0.1; // 10%ÊàêÂäüÁéá
                
                if (success) {
                    equipment.reinforce++;
                    addBattleLog(`Âº∫ÂåñÊàêÂäüÔºÅ${equipment.name}Âº∫ÂåñËá≥+${equipment.reinforce}`);
                    
                    // ÊòæÁ§∫Âº∫ÂåñÁªìÊûúÂºπÁ™ó
                    showResultModal(`Âº∫ÂåñÊàêÂäüÔºÅ${equipment.name}Âº∫ÂåñËá≥+${equipment.reinforce}`, 'success');
                } else {
                    addBattleLog(`Âº∫ÂåñÂ§±Ë¥•ÔºÅ${equipment.name}Âº∫ÂåñÂ§±Ë¥•`);
                    
                    // ÊòæÁ§∫Âº∫ÂåñÁªìÊûúÂºπÁ™ó
                    showResultModal(`Âº∫ÂåñÂ§±Ë¥•ÔºÅ${equipment.name}Âº∫ÂåñÂ§±Ë¥•`, 'danger');
                }
                
                updateUI();
                renderWornEquipment();
                
                // Ëá™Âä®‰øùÂ≠ò
                saveGameData();
            });
            
            // ËøõÂåñË£ÖÂ§á
            document.getElementById('do-evolve').addEventListener('click', () => {
                const selectedEquipment = document.querySelector('.equipment-item.selected');
                if (!selectedEquipment) {
                    addBattleLog('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰ª∂Ë£ÖÂ§áËøõË°åËøõÂåñ');
                    return;
                }
                
                const equipmentId = parseInt(selectedEquipment.dataset.id);
                const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                
                if (!equipment) return;
                
                // Ê£ÄÊü•ÊòØÂê¶Â§Ñ‰∫éÊàòÊñóÁä∂ÊÄÅ
                if (gameData.battleInterval) {
                    showBattleOperationModal();
                    return;
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÊúâË∂≥Â§üÁöÑÂç∑ËΩ¥
                const scrollCount = gameData.equipment.inventory.filter(e => e.name === "ÊèêÂçáÂç∑ËΩ¥").length;
                
                if (scrollCount === 0) {
                    addBattleLog('ËøõÂåñÂ§±Ë¥•ÔºöÊ≤°ÊúâË∂≥Â§üÁöÑÊèêÂçáÂç∑ËΩ¥');
                    return;
                }
                
                // Ê∂àËÄóÂç∑ËΩ¥
                const scrollIndex = gameData.equipment.inventory.findIndex(e => e.name === "ÊèêÂçáÂç∑ËΩ¥");
                if (scrollIndex !== -1) {
                    gameData.equipment.inventory.splice(scrollIndex, 1);
                }
                
                // ËøõÂåñÁªìÊûú
                const success = Math.random() < 0.1; // 10%ÊàêÂäüÁéá
                
                if (success) {
                    equipment.evolve++;
                    addBattleLog(`ËøõÂåñÊàêÂäüÔºÅ${equipment.name}ËøõÂåñËá≥‚òÖ${equipment.evolve}`);
                    
                    // ÊòæÁ§∫ËøõÂåñÁªìÊûúÂºπÁ™ó
                    showResultModal(`ËøõÂåñÊàêÂäüÔºÅ${equipment.name}ËøõÂåñËá≥‚òÖ${equipment.evolve}`, 'success');
                } else {
                    addBattleLog(`ËøõÂåñÂ§±Ë¥•ÔºÅ${equipment.name}ËøõÂåñÂ§±Ë¥•`);
                    
                    // ÊòæÁ§∫ËøõÂåñÁªìÊûúÂºπÁ™ó
                    showResultModal(`ËøõÂåñÂ§±Ë¥•ÔºÅ${equipment.name}ËøõÂåñÂ§±Ë¥•`, 'danger');
                }
                
                updateUI();
                renderWornEquipment();
                
                // Ëá™Âä®‰øùÂ≠ò
                saveGameData();
            });
            
            // Ë¥≠‰π∞ËøõÂåñÂç∑ËΩ¥
            document.getElementById('buy-evolve-scroll').addEventListener('click', () => {
                const crystalCost = 10; // 10Ê∞¥Êô∂Ë¥≠‰π∞1Âç∑
                const scroll = generateEquipment('badge', 1, 'common');
                scroll.name = "ÊèêÂçáÂç∑ËΩ¥";
                scroll.baseAttributes = [];
                scroll.additionalAttributes = [];
                
                if (gameData.character.crystal >= crystalCost) {
                    gameData.character.crystal -= crystalCost;
                    gameData.equipment.inventory.push(scroll);
                    addBattleLog(`Ë¥≠‰π∞‰∫Ü1‰∏™ÊèêÂçáÂç∑ËΩ¥ÔºåËä±Ë¥π${crystalCost}Ê∞¥Êô∂`);
                    renderInventory();
                } else {
                    addBattleLog('Ê∞¥Êô∂‰∏çË∂≥ÔºåÊó†Ê≥ïË¥≠‰π∞ÊèêÂçáÂç∑ËΩ¥');
                }
            });
            
            // ÊöÇÂÅúÊàòÊñóÊåâÈíÆ
            document.getElementById('pause-battle').addEventListener('click', () => {
                if (gameData.battleInterval) {
                    clearInterval(gameData.battleInterval);
                    gameData.battleInterval = null;
                    addBattleLog('ÊàòÊñóÂ∑≤ÊöÇÂÅú');
                } else {
                    addBattleLog('ÂΩìÂâçÊ≤°ÊúâÊàòÊñó');
                }
            });
            
            // ÂÖ≥Èó≠ÊàòÊñóÊìç‰ΩúÊèêÁ§∫ÂºπÁ™ó
            document.getElementById('battle-operation-close-btn').addEventListener('click', () => {
                document.getElementById('battle-operation-modal').style.display = 'none';
            });
            
            // ÂÖ≥Èó≠ÁªìÊûúÂºπÁ™ó
            document.getElementById('modal-close-btn').addEventListener('click', () => {
                document.getElementById('result-modal').style.display = 'none';
            });
            
            // ÂÖ≥Èó≠ËßâÈÜíÂºπÁ™ó
            document.getElementById('awakening-confirm-btn').addEventListener('click', () => {
                document.getElementById('awakening-modal').style.display = 'none';
            });
            
            // ÂÖ≥Èó≠ÊâÄÊúâÂºπÁ™óÁöÑÂÖ≥Èó≠ÊåâÈíÆ
            document.querySelectorAll('.modal-close').forEach(closeBtn => {
                closeBtn.addEventListener('click', () => {
                    closeBtn.closest('.modal').style.display = 'none';
                });
            });
            
            // Ë£ÖÂ§áÊßΩÁÇπÂáª‰∫ã‰ª∂
            document.querySelectorAll('.slot').forEach(slot => {
            slot.addEventListener('click', (e) => {
                // Ê£ÄÊü•ÊòØÂê¶ÁÇπÂáªÁöÑÊòØ‚ÄúËÑ±‰∏ã‚ÄùÊåâÈíÆ
                if (e.target && e.target.classList.contains('btn-remove-equipment')) {
                    return; // ‰∏çÊâßË°åÊâìÂºÄË£ÖÂ§áÈÄâÊã©ÂºπÁ™óÁöÑÊìç‰Ωú
                }
                
                const slotId = slot.dataset.slot;
                showEquipmentSelectionModal(slotId);
            });
        });
            
            // Ë£ÖÂ§áÈÄâÊã©ÂºπÁ™óÂÖ≥Èó≠ÊåâÈíÆ
            document.getElementById('equipment-selection-close').addEventListener('click', () => {
                document.getElementById('equipment-selection-modal').style.display = 'none';
            });
            
            // Ë£ÖÂ§áÈÄâÊã©ÂºπÁ™óÂèñÊ∂àÊåâÈíÆ
            document.getElementById('equipment-selection-cancel').addEventListener('click', () => {
                document.getElementById('equipment-selection-modal').style.display = 'none';
            });
        }

        // ÊòæÁ§∫ÁªìÊûúÂºπÁ™ó
        function showResultModal(message, type) {
            document.getElementById('modal-body').innerHTML = message;
            document.getElementById('result-modal').style.display = 'flex';
            
            // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆÊåâÈíÆÈ¢úËâ≤
            const buttons = document.querySelectorAll('#result-modal .btn');
            buttons.forEach(btn => {
                btn.className = `btn btn-${type}`;
            });
        }

        // ÊòæÁ§∫ËßâÈÜíÂºπÁ™ó
        function showAwakeningModal() {
            document.getElementById('awakening-modal').style.display = 'flex';
            
            // ËßâÈÜíÂ§ÑÁêÜ
            gameData.character.awakeningLevel++;
            gameData.character.level = 1;
            gameData.character.exp = 0;
            gameData.character.maxExp = 100;
            
            // Êõ¥Êñ∞ÊúÄÂ§ßÁªèÈ™å
            gameData.character.maxExp = gameData.character.level * gameData.character.level * 100;
            
            // Êõ¥Êñ∞Â±ûÊÄß
            updateDerivedStats();
            
            // Êõ¥Êñ∞UI
            updateUI();
        }

        // ÊòæÁ§∫ÊàòÊñó‰∏≠Êìç‰ΩúÊèêÁ§∫ÂºπÁ™ó
        function showBattleOperationModal() {
            elements.battleOperationModal.style.display = 'flex';
        }

        // ÊòæÁ§∫Ë£ÖÂ§áÈÄâÊã©ÂºπÁ™ó
        function showEquipmentSelectionModal(slotId) {
            // Ê∏ÖÁ©∫Ë£ÖÂ§áÈÄâÊã©ÁΩëÊ†º
            elements.equipmentSelectionGrid.innerHTML = '';
            
            // Á≠õÈÄâËÉåÂåÖ‰∏≠ÂØπÂ∫îÈÉ®‰ΩçÁöÑË£ÖÂ§á
            const slotEquipment = gameData.equipment.inventory.filter(equipment => {
                return equipment.slot === slotId && !equipment.equipped;
            });
            
            // Â¶ÇÊûúÊ≤°ÊúâÂèØÁî®Ë£ÖÂ§áÔºåÊòæÁ§∫ÊèêÁ§∫
            if (slotEquipment.length === 0) {
                const noEquipmentElement = document.createElement('div');
                noEquipmentElement.className = 'stat-item';
                noEquipmentElement.innerHTML = `<div>Ê≤°ÊúâÂèØÁî®ÁöÑ${equipmentSlots[slotId]}Ë£ÖÂ§á</div>`;
                elements.equipmentSelectionGrid.appendChild(noEquipmentElement);
            } else {
                // Ê∑ªÂä†Ë£ÖÂ§áÂà∞ÈÄâÊã©ÁΩëÊ†º
                slotEquipment.forEach(equipment => {
                    const equipmentElement = document.createElement('div');
                    equipmentElement.className = `equipment-item ${equipment.locked ? 'locked' : ''}`;
                    equipmentElement.dataset.id = equipment.id;
                    
                    equipmentElement.innerHTML = `
                        <div class="equipment-name">
                            <span class="quality quality-${equipment.quality}">${equipmentQuality[equipment.quality].name}</span> ${equipment.name}
                            ${equipment.reinforce > 0 ? `+${equipment.reinforce}` : ''}
                            ${equipment.evolve > 0 ? `‚òÖ${equipment.evolve}` : ''}
                        </div>
                        <div class="equipment-info">
                            ÈÉ®‰Ωç: ${equipmentSlots[equipment.slot]} | Á≠âÁ∫ß: ${equipment.level}
                        </div>
                        <div class="equipment-attrs">
                            ${equipment.baseAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                            ${equipment.additionalAttributes.map(attr => `<div class="equipment-attr">${attr}</div>`).join('')}
                        </div>
                        <button class="btn btn-success" data-equip-id="${equipment.id}">Á©øÊà¥</button>
                    `;
                    
                    elements.equipmentSelectionGrid.appendChild(equipmentElement);
                });
            }
            
            // ËÆæÁΩÆÂºπÁ™óÊ†áÈ¢ò
            document.querySelector('.equipment-selection-title').textContent = `ÈÄâÊã©${equipmentSlots[slotId]}`;
            
            // ÊòæÁ§∫ÂºπÁ™ó
            elements.equipmentSelectionModal.style.display = 'flex';
            
            // Ê∑ªÂä†Ë£ÖÂ§áÈÄâÊã©‰∫ã‰ª∂
            document.querySelectorAll('[data-equip-id]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const equipmentId = parseInt(btn.dataset.equipId);
                    const equipment = gameData.equipment.inventory.find(e => e.id === equipmentId);
                    
                    if (equipment) {
                        // Ê£ÄÊü•Ë£ÖÂ§áÁ≠âÁ∫ßÊòØÂê¶È´ò‰∫éËßíËâ≤Á≠âÁ∫ß
                        if (equipment.level > gameData.character.level) {
                            addBattleLog(`Ë£ÖÂ§áÁ≠âÁ∫ß${equipment.level}È´ò‰∫é‰Ω†ÁöÑËßíËâ≤Á≠âÁ∫ß${gameData.character.level}ÔºåÊó†Ê≥ïÁ©øÊà¥`);
                            return;
                        }
                        
                        // Ê£ÄÊü•ËØ•ÈÉ®‰ΩçÊòØÂê¶Â∑≤ÊúâË£ÖÂ§á
                        if (gameData.equipment.slots[slotId]) {
                            addBattleLog(`ËØ•ÈÉ®‰ΩçÂ∑≤ÊúâË£ÖÂ§áÔºåÊó†Ê≥ïÁ©øÊà¥`);
                            return;
                        }
                        
                        // Á©øÊà¥Êñ∞Ë£ÖÂ§á
                        gameData.equipment.slots[slotId] = equipment;
                        equipment.equipped = true;
                        
                        // Êõ¥Êñ∞Â±ûÊÄß
                        updateDerivedStats();
                        
                        // ÂÖ≥Èó≠ÂºπÁ™ó
                        elements.equipmentSelectionModal.style.display = 'none';
                        
                        // Êõ¥Êñ∞UI
                        updateUI();
                        renderInventory();
                        
                        // Ëá™Âä®‰øùÂ≠ò
                        saveGameData();
                    }
                });
            });
        }

        // Ê£ÄÊü•Á¶ªÁ∫øÊî∂Áõä
        function checkOfflineGains() {
            const now = Date.now();
            const offlineTime = (now - gameData.lastActivityTime) / 1000; // Áßí
            
            if (offlineTime > 0) {
                // ËÆ°ÁÆóÁ¶ªÁ∫øÊàòÊñóÊ¨°Êï∞
                const battles = Math.floor(offlineTime / 10); // ÊØè10Áßí‰∏ÄÊ¨°ÊàòÊñó
                
                if (battles > 0) {
                    // ËÆ°ÁÆóÁ¶ªÁ∫øÊî∂Áõä
                    gameData.offlineExp = Math.floor(0.5 * gameData.character.level * offlineTime / 60); // ÊØèÂàÜÈíü0.5*Á≠âÁ∫ßÁªèÈ™å
                    gameData.offlineGold = Math.floor(1 * gameData.character.level * offlineTime / 60); // ÊØèÂàÜÈíü1*Á≠âÁ∫ßÈáëÂ∏Å
                    
                    // Êõ¥Êñ∞ËßíËâ≤Êï∞ÊçÆ
                    gameData.character.exp += gameData.offlineExp;
                    gameData.character.gold += gameData.offlineGold;
                    
                    // Ê£ÄÊü•ÂçáÁ∫ß
                    while (gameData.character.exp >= gameData.character.maxExp && gameData.character.level < 200) {
                        gameData.character.level++;
                        gameData.character.exp -= gameData.character.maxExp;
                        gameData.character.maxExp = gameData.character.level * gameData.character.level * 100;
                        
                        // Êõ¥Êñ∞Â±ûÊÄß
                        updateDerivedStats();
                        
                        // Ê£ÄÊü•ÊòØÂê¶ËææÂà∞200Á∫ß
                        if (gameData.character.level === 200) {
                            showAwakeningModal();
                        }
                    }
                    
                    // Ê∑ªÂä†Á¶ªÁ∫øÊî∂ÁõäÊó•Âøó
                    addBattleLog(`Á¶ªÁ∫øÊî∂ÁõäÔºöËé∑Âæó${battles}Ê¨°ÊàòÊñóÁªèÈ™åÔºå${gameData.offlineExp}ÁªèÈ™åÔºå${gameData.offlineGold}ÈáëÂ∏Å`);
                    
                    // Êõ¥Êñ∞ÊúÄÂêéÊ¥ªÂä®Êó∂Èó¥
                    gameData.lastActivityTime = now;
                    
                    // ‰øùÂ≠òÊï∞ÊçÆ
                    saveGameData();
                    
                    // Êõ¥Êñ∞UI
                    updateUI();
                }
            }
        }

        // ÂàùÂßãÂåñÊ∏∏Êàè
        window.addEventListener('load', initGame);
    </script>
<!--ÂÆ¢Êúç ÂºÄÂßã-->
<script src="//g8hh.github.io/static/js/jquery.min.js"></script>
<link rel="stylesheet" href="//g8hh.github.io/static/css/kf.css" type="text/css" media="screen" charset="utf-8">
<script src="//g8hh.github.io/static/js/kf.js"></script>
<!-- ÂÆ¢Êúç ÁªìÊùü -->
<!--Á´ôÈïøÁªüËÆ°--> 
<div style="display: none">
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?028b1b5f659ed138230f4cafd7ad0dfc";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    </div>
</body>
</html>